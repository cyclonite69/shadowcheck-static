# ShadowCheck - SIGINT Forensics Platform

[![GitHub stars](https://img.shields.io/github/stars/cyclonite69/shadowcheck-static?style=flat-square)](https://github.com/cyclonite69/shadowcheck-static/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/cyclonite69/shadowcheck-static?style=flat-square)](https://github.com/cyclonite69/shadowcheck-static/network)
[![GitHub issues](https://img.shields.io/github/issues/cyclonite69/shadowcheck-static?style=flat-square)](https://github.com/cyclonite69/shadowcheck-static/issues)
[![GitHub license](https://img.shields.io/github/license/cyclonite69/shadowcheck-static?style=flat-square)](LICENSE)
[![Node.js](https://img.shields.io/badge/node-%3E%3D20.0.0-brightgreen?style=flat-square)](https://nodejs.org/)
[![PostgreSQL](https://img.shields.io/badge/postgresql-%3E%3D18-blue?style=flat-square)](https://www.postgresql.org/)
[![GitHub last commit](https://img.shields.io/github/last-commit/cyclonite69/shadowcheck-static?style=flat-square)](https://github.com/cyclonite69/shadowcheck-static/commits)
[![GitHub repo size](https://img.shields.io/github/repo-size/cyclonite69/shadowcheck-static?style=flat-square)](https://github.com/cyclonite69/shadowcheck-static)

üõ°Ô∏è **Production-grade SIGINT forensics and wireless network analysis platform.** Real-time threat detection, geospatial correlation via PostGIS, and interactive analysis dashboards.

## Current Development Direction

- **React/Vite frontend** with TypeScript support is fully integrated (`client/src/` routes like `/geospatial-intel`, `/analytics`, `/ml-training`, `/endpoint-test`)
- **Modern modular backend architecture** with organized services in `server/src/api/`, `server/src/services/`, and `server/src/repositories/`
- **Universal filter system** with 20+ filter types supporting complex queries across all pages
- **DevContainer support** for consistent development environments with VS Code integration
- **Static server** with security headers for production deployment and Lighthouse audits
- **PostGIS materialized views** for fast explorer pages with precomputed threat intelligence
- **ETL pipeline** lives in `etl/` with modular load/transform/promote steps feeding the explorer views; staging tables remain UNLOGGED for ingestion speed
- **Machine learning** with multiple algorithms (Logistic Regression, Random Forest, Gradient Boosting) and hyperparameter optimization

## Features

- **Dashboard:** Real-time network environment overview with threat indicators and interactive metrics cards
- **Geospatial Analysis:** Interactive Mapbox visualization with spatial correlation, clustering, and **Unified Network Tooltips**
- **Network Analysis:** Deep dive into individual network characteristics and behavior patterns with universal filtering
- **Threat Detection:** ML-powered identification of surveillance devices and anomalies with multiple algorithms
- **Analytics:** Advanced charts and graphs for network pattern analysis with Chart.js visualizations
- **Address Enrichment:** Multi-API venue and business identification (4 sources: OpenCage, LocationIQ, Abstract, Overpass)
- **Device Classification:** Automatic identification of device types and behavioral profiling
- **Trilateration:** AP location calculation from multiple observations with accuracy estimation
- **Machine Learning:** Multi-algorithm threat detection with hyperparameter optimization and model versioning
- **Universal Filters:** 20+ filter types supporting complex temporal, spatial, and behavioral queries
- **DevContainer Support:** Consistent development environment with VS Code integration
- **Security Headers:** Production-ready deployment with CSP, HTTPS enforcement, and Lighthouse optimization
- **Admin Features:** System administration interface with configuration management, user settings, and role-based gating
- **Admin Database Security**: Multi-user model with read-only `shadowcheck_user` and privileged `shadowcheck_admin`

## Recent Improvements (January 2026)

‚úÖ **TypeScript Migration & Build Pipeline**

- **Complete TypeScript migration**: Converted 60+ files including server utilities, middleware, ETL scripts, and build tools
- **Production build pipeline**: Compiled TypeScript server for Docker deployment eliminates runtime ts-node overhead
- **Type safety**: Added comprehensive interfaces and types for database operations, API responses, and service layers
- **Build optimization**: Frontend and server compile separately with proper path resolution for containerized deployment

‚úÖ **Dashboard & UI Enhancements**

- **Fixed analytics card display**: Removed incorrect "0 Total Observations" from navigation cards
- **Threat level filtering**: Dashboard threat severity counts now properly respect active filter selections
- **Interactive metrics**: Real-time dashboard cards with proper data binding and filter awareness

‚úÖ **Data Integrity Fixes**

- Fixed GeoSpatial table showing incorrect default values (signal: 0 dBm, channel: 0, frequency: 0 MHz)
- Resolved analytics widgets failures (Temporal Activity, Radio Types Over Time, Threat Score Trends)
- Fixed max distance calculation to use real PostGIS geographic distances instead of ~238m signal approximation
- Resolved threat score column sorting issues (rule_score, ml_score, ml_weight, ml_boost now sortable)

‚úÖ **API & Backend Improvements**

- Networks API now uses latest observation data for accurate real-time information
- Added manufacturer field population via radio_manufacturers table with OUI prefix matching
- Fixed WiGLE observation points rendering with correct schema namespace (app vs public)
- Enhanced analytics endpoints with proper null value handling and appropriate data sources

‚úÖ **Frontend Enhancements**

- Fixed data transformer field name mismatches (network_type ‚Üí type, avg_score ‚Üí avgScore)
- Added missing API calls for temporal, radio-time, and threat-trends analytics
- Improved geographic distance display and invalid value handling

‚úÖ **Testing & Quality**

- Added comprehensive regression tests for networks API data integrity
- Enhanced error handling and validation across all endpoints

## Architecture

**Backend:** Node.js/Express REST API with PostgreSQL + PostGIS (Modular architecture with Repositories and Services)  
**Frontend:** React + Vite with TypeScript (explorers and dashboards)  
**Database:** PostgreSQL 18 with PostGIS extension (566,400+ location records, 173,326+ unique networks)  
**Development:** DevContainer support with VS Code integration  
**Deployment:** Static server with security headers for production

## Prerequisites

- Node.js 20+
- PostgreSQL 18+ with PostGIS
- TypeScript 5.0+ (included in devDependencies)

## Quick Start

### 1. Clone and Install

```bash
git clone https://github.com/your-username/shadowcheck-static.git
cd shadowcheck-static
npm install
```

### 2. Database Setup

Create PostgreSQL database with PostGIS and secure users:

```sql
-- Standard application user (Read-only on production tables)
CREATE ROLE shadowcheck_user WITH LOGIN PASSWORD 'your_password';
-- Administrative user (Full access for imports/tagging)
CREATE ROLE shadowcheck_admin WITH LOGIN PASSWORD 'admin_password';

CREATE DATABASE shadowcheck_db OWNER shadowcheck_admin;
\c shadowcheck_db
CREATE EXTENSION postgis;
```

Apply security migration: `psql -U shadowcheck_admin -d shadowcheck_db -f sql/migrations/20260129_implement_db_security.sql`

### 3. Environment Configuration

Create `.env` in project root (or load secrets via keyring):

```
DB_USER=shadowcheck_user
DB_HOST=shadowcheck_postgres
DB_NAME=shadowcheck_db
DB_PASSWORD=your_password
DB_PORT=5432
PORT=3001
```

See `.env.example` for all options.
If you're running PostgreSQL locally, set `DB_HOST=localhost` and use your local database name.

### 4. Run Migrations

```bash
psql -U shadowcheck_user -d shadowcheck_db -f sql/functions/create_scoring_function.sql
psql -U shadowcheck_user -d shadowcheck_db -f sql/functions/fix_kismet_functions.sql
psql -U shadowcheck_user -d shadowcheck_db -f sql/migrations/migrate_network_tags_v2.sql
# Follow the order in sql/migrations/README.md for remaining migrations
```

### 5. Start Server

```bash
npm start
```

Server runs on `http://localhost:3001`

## Pages

- Dashboard (React): `/` and `/dashboard`
- Geospatial Intelligence (React): `/geospatial` or `/geospatial-intel`
- Analytics (React): `/analytics`
- API Test (React): `/endpoint-test`
- ML Training (React): `/ml-training`
- Admin: `/admin`
- WiGLE (React): `/wigle`
- Kepler (React): `/kepler`

## API Endpoints

- `GET /api/networks` - Paginated network list with filtering
- `GET /api/networks/observations/:bssid` - Get all observation records for a network
- `GET /api/threats/quick` - High-performance threat detection overview
- `GET /api/threats/detect` - Detailed movement-based threat analysis
- `GET /api/analytics/*` - Statistical data distribution endpoints
- `POST /api/network-tags/:bssid` - Manually classify a network (admin)
- `GET /api/network-tags/:bssid` - Get tags for a specific network
- `GET /api/mapbox-token` - Retrieve Mapbox API token
- `GET /api/wigle/api-status` - Check WiGLE API connectivity

See `server/server.js` for full endpoint documentation.

## Machine Learning

ShadowCheck includes multi-algorithm threat detection with model training and hyperparameter optimization.

### Training Endpoint

**POST** `/api/ml/train`

Trains logistic regression model on all tagged networks in database.

**Request:**

```bash
curl -X POST http://localhost:3001/api/ml/train
```

**Response:**

```json
{
  "ok": true,
  "model": {
    "type": "logistic_regression",
    "accuracy": 0.92,
    "precision": 0.88,
    "recall": 0.95,
    "f1": 0.91,
    "rocAuc": 0.94
  },
  "trainingData": {
    "totalNetworks": 45,
    "threats": 18,
    "falsePositives": 27
  },
  "message": "Model trained successfully"
}
```

**Errors:**

- `400`: Fewer than 10 tagged networks (minimum required)
- `503`: ML model module unavailable

### Status Endpoint

**GET** `/api/ml/status`

Check model training status and tag statistics.

### Advanced ML Iteration

Test multiple algorithms with grid search and cross-validation:

```bash
pip install -r scripts/ml/requirements.txt
python3 scripts/ml/ml-iterate.py
```

Tests Logistic Regression, Random Forest, and Gradient Boosting with hyperparameter tuning.

### Features Used for Training

- Observation count (network detections)
- Unique days seen
- Geographic distribution (location clustering)
- Signal strength (RSSI max)
- Distance range from home location
- Behavioral flags (seen at home vs. away)

## Project Structure

```
shadowcheck-static/
‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/    # ‚öõÔ∏è React components (TypeScript)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx        # ‚öõÔ∏è Main React app
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.tsx       # ‚öõÔ∏è Frontend entry point
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.ts     # ‚öõÔ∏è Frontend build config (TypeScript)
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/           # üîß REST API routes (TypeScript)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/      # üîß Business logic (TypeScript)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/    # üîß Express middleware (TypeScript)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/         # üîß Server utilities (TypeScript)
‚îÇ   ‚îî‚îÄ‚îÄ server.js          # üîß Main server entry point
‚îú‚îÄ‚îÄ etl/                   # üìä ETL pipeline (TypeScript)
‚îú‚îÄ‚îÄ scripts/               # üõ†Ô∏è Utility scripts (TypeScript)
‚îú‚îÄ‚îÄ tests/                 # üß™ Jest tests (TypeScript)
‚îú‚îÄ‚îÄ sql/                   # üóÑÔ∏è Database migrations & functions
‚îú‚îÄ‚îÄ docs/                  # üìö Documentation
‚îú‚îÄ‚îÄ tsconfig.json          # ‚öôÔ∏è TypeScript config (client)
‚îú‚îÄ‚îÄ tsconfig.server.json   # ‚öôÔ∏è TypeScript config (server)
‚îî‚îÄ‚îÄ docker-compose.yml     # üê≥ Docker configuration
```

**üìñ See [docs/architecture/PROJECT_STRUCTURE.md](docs/architecture/PROJECT_STRUCTURE.md) for detailed frontend/backend organization.**

Also see [docs/DIRECTORY_STRUCTURE.md](docs/DIRECTORY_STRUCTURE.md) for complete details.

## Development

**Run dev server:**

```bash
npm run dev
```

**Run tests:**

```bash
npm test
```

## Configuration

Key environment variables (see `.env.example`):

- `DB_*` - PostgreSQL connection
- `PORT` - Server port (default: 3001)
- `NODE_ENV` - development or production

## Security

- Use strong database credentials in production
- Enable HTTPS/TLS at reverse proxy layer
- Restrict API access via rate limiting (already enabled)
- See `SECURITY.md` for detailed security guidelines

### Security Headers & Lighthouse Audits

For accurate Lighthouse Best Practices audits, use the static server with security headers:

```bash
npm run build
npm run serve:dist
# Then run Lighthouse against http://localhost:4000
```

The static server (`server/static-server.js`) applies these headers:

- `Content-Security-Policy` (allows Mapbox CDN)
- `X-Frame-Options: DENY`
- `X-Content-Type-Options: nosniff`
- `Referrer-Policy: strict-origin-when-cross-origin`
- `Permissions-Policy: geolocation=(), microphone=(), camera=()`
- `Cross-Origin-Opener-Policy: same-origin-allow-popups`

### Third-Party Cookies Notice

**Expected Lighthouse warning:** "Uses third-party cookies" from `api.mapbox.com`.

This is an expected behavior when using Mapbox GL JS. Mapbox sets cookies for:

- Session management and rate limiting
- Telemetry (can be disabled via `mapboxgl.config.COLLECT_TELEMETRY = false`)
- Tile caching

These cookies are required for Mapbox functionality and cannot be eliminated without self-hosting all map tiles (impractical for most use cases).

### SEO Indexing

By default, `robots.txt` disallows all crawling (dev/staging). For production:

```bash
npm run build:public  # Sets ROBOTS_ALLOW_INDEXING=true
```

## Documentation

Additional documentation is available in the `docs` directory. See [docs/README.md](docs/README.md) for navigation.

## Contributing

See `CONTRIBUTING.md` for code standards and workflow.

## Code of Conduct

See `CODE_OF_CONDUCT.md`.

## License

MIT. See `LICENSE` for details.
